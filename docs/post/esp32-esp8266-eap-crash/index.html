<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 5.0.0-beta.3 for Hugo"><meta name=author content="Matheus Eduardo Garbelini"><meta name=description content="Crashing ESP devices connected to enterprise networks"><link rel=alternate hreflang=en-us href=../../post/esp32-esp8266-eap-crash/><link rel=preconnect href=https://fonts.gstatic.com crossorigin><meta name=theme-color content="#1565c0"><script src=../../js/mathjax-config.js></script><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.0/css/academicons.min.css integrity="sha512-W4yqoT1+8NLkinBLBZko+dFB2ZbHsYLDdr50VElllRcNt2Q4/GSs6u71UHKxB7S6JEMCp5Ve4xjh3eGQl/HRvg==" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css integrity="sha256-FMvZuGapsJLjouA6k7Eo2lusoAX9i0ShlWFG6qt7SLc=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/github.min.css crossorigin=anonymous title=hl-light media=print onload="this.media='all'"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/dracula.min.css crossorigin=anonymous title=hl-dark media=print onload="this.media='all'" disabled><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.css integrity="sha512-1xoFisiGdy9nvho8EgXuXvnpR5GAMSjFwp40gSRE3NwdUdIMIKuPa7bqoUhLD0O/5tPNhteAsE5XyyMi5reQVA==" crossorigin=anonymous media=print onload="this.media='all'"><script src=https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.2.2/lazysizes.min.js integrity="sha512-TmDwFLhg3UA4ZG0Eb4MIyT1O1Mb+Oww5kFG0uHqXsdbyZz9DcvYQhKpGgNkamAI6h2lGGZq2X8ftOJvF/XjTUg==" crossorigin=anonymous async></script><script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js integrity crossorigin=anonymous async></script><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload="this.media='all'"><link rel=stylesheet href=../../css/wowchemy.dcfbcbc9c1fc922bede8b95538a0ef51.css><link rel=manifest href=../../index.webmanifest><link rel=icon type=image/png href=../../images/icon_hue96a2db987773b26a138959a554df568_81308_32x32_fill_lanczos_center_2.png><link rel=apple-touch-icon type=image/png href=../../images/icon_hue96a2db987773b26a138959a554df568_81308_180x180_fill_lanczos_center_2.png><link rel=canonical href=../../post/esp32-esp8266-eap-crash/><meta property="twitter:card" content="summary_large_image"><meta property="og:site_name" content="M. E. Garbelini"><meta property="og:url" content="/post/esp32-esp8266-eap-crash/"><meta property="og:title" content="ESP32/ESP8266 EAP client crash (CVE-2019-12586) | M. E. Garbelini"><meta property="og:description" content="Crashing ESP devices connected to enterprise networks"><meta property="og:image" content="/post/esp32-esp8266-eap-crash/featured.png"><meta property="twitter:image" content="/post/esp32-esp8266-eap-crash/featured.png"><meta property="og:locale" content="en-us"><meta property="article:published_time" content="2019-09-03T11:31:46+08:00"><meta property="article:modified_time" content="2017-11-21T21:47:02+00:00"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"/post/esp32-esp8266-eap-crash/"},"headline":"ESP32/ESP8266 EAP client crash (CVE-2019-12586)","image":["/post/esp32-esp8266-eap-crash/featured.png"],"datePublished":"2019-09-03T11:31:46+08:00","dateModified":"2017-11-21T21:47:02Z","author":{"@type":"Person","name":"Matheus Eduardo Garbelini"},"publisher":{"@type":"Organization","name":"M. E. Garbelini","logo":{"@type":"ImageObject","url":"/images/icon_hue96a2db987773b26a138959a554df568_81308_192x192_fill_lanczos_center_2.png"}},"description":"Crashing ESP devices connected to enterprise networks"}</script><title>ESP32/ESP8266 EAP client crash (CVE-2019-12586) | M. E. Garbelini</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper><script src=../../js/wowchemy-init.min.9f8405b7756f5e178a738a09c302f8b3.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class=col-6><h1>Search</h1></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=Close><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box><input name=q id=search-query placeholder=Search... autocapitalize=off autocomplete=off autocorrect=off spellcheck=false type=search class=form-control aria-label=Search...></div></section><section class=section-search-results><div id=search-hits></div></section></div></aside><div class=page-header><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=../../>M. E. Garbelini</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar aria-expanded=false aria-label="Toggle navigation">
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=../../>M. E. Garbelini</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=../../#about><span>Home</span></a></li><li class=nav-item><a class=nav-link href=../../#posts><span>Posts</span></a></li><li class=nav-item><a class=nav-link href=../../#featured><span>Publications</span></a></li><li class=nav-item><a class=nav-link href=../../#contact><span>Contact</span></a></li><li class=nav-item><a class=nav-link href=../../media/cv_matheus_garbelini.pdf><span>CV</span></a></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=Search><i class="fas fa-search" aria-hidden=true></i></a></li></ul></div></nav></div><div class=page-body><article class=article><div class="article-container pt-3"><h1>ESP32/ESP8266 EAP client crash (CVE-2019-12586)</h1><p class=page-subtitle>Crashing ESP devices connected to enterprise networks</p><div class=article-metadata><div><span>Matheus Eduardo Garbelini</span></div><span class=article-date>Last updated on
Nov 21, 2017</span>
<span class=middot-divider></span><span class=article-reading-time>2 min read</span>
<span class=middot-divider></span><span class=article-categories><i class="fas fa-folder mr-1"></i><a href=../../category/vulnerability-disclosure/>Vulnerability Disclosure</a></span></div></div><div class="article-header article-container featured-image-wrapper mt-4 mb-4" style=max-width:720px;max-height:321px><div style=position:relative><img src=../../post/esp32-esp8266-eap-crash/featured_hufabe62720c161cd38467e0cef9373b7c_1361507_720x0_resize_lanczos_2.png alt class=featured-image></div></div><div class=article-container><div class=article-style><h1 id=vulnerability-description>Vulnerability Description</h1><p>The vulnerability (<a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-12586" target=_blank rel=noopener>CVE-2019-12586</a>) found in SDKs of ESP32 and ESP8266 allows an attacker to precisely cause a crash in any ESP32/ESP8266 connected to an enterprise network. In combination with the <a href=../../post/zero-pmk-installation/>Zero PMK Installation vulnerability</a>, it could increase the damages to any unpatched device.</p><p>The affected stable and development versions are listed below:</p><ul><li>ESP32-IDF Stable <a href=https://github.com/espressif/ESP8266_NONOS_SDK/releases/tag/v3.0 target=_blank rel=noopener>release 3.0</a> and earlier. Vulnerable until <strong>July 15, 2019</strong>.</li><li>ESP32-IDF Development Master <a href=https://github.com/espressif/esp-idf/commit/b68f5b4f8cae3d315a4d82dea5f5a623a18e0c72 target=_blank rel=noopener>#b68f5b4f</a> and earlier. Vulnerable until <strong>May 30, 2019</strong>.</li><li>Arduino-ESP32 Pre-release <a href=https://github.com/espressif/arduino-esp32/releases/tag/1.0.3-rc2 target=_blank rel=noopener>1.0.3-rc2</a> and earlier. Vulnerable until <strong>September 5, 2019.</strong></li><li>Arduino-ESP32 Development Master <a href=https://github.com/espressif/arduino-esp32/commit/aff2e42ac612e32e6c52283e16d85d83ed6ef03b target=_blank rel=noopener>#aff2e42</a> and earlier. Vulnerable until <strong>May 12, 2019</strong>.</li></ul><h1 id=exploit-scenario>Exploit scenario</h1><p>​ The DoS vulnerability can be better understood when presented in the following diagram below. Step 8 is the malicious message which could be injected by an attacker in radio range. In this case, if the ESP32/8266 Wi-Fi client receives a EAP-Success message just after starting the EAP procedure, it crashes immediately. This happens because the device is erroneously tries to finish the EAP procedure, but doesn&rsquo;t have a valid PMK exchanged and validated.</p><img src=Enterprise_crash_eap.png alt=drawing width=250><p>A Wireshark capture (<a href=crash_capture.pcapng>download</a>) of the attacker triggering the crash is shown in the figure below:</p><img src=wireshark_capture.png alt=drawing width=750><h1 id=impact>Impact</h1><p>This vulnerability allows attackers in radio range to trigger a crash to any ESP device connected to an enterprise network. As the respective devices SDK (ESP-IDF for ESP32 and NONOS-SDK for ESP8266) enables watchdog by default, the devices won&rsquo;t hang in face of such DoS attack. Espressif has fixed such problem and committed patches for ESP32 SDK, however, as of the date of this post, the NONOS SDK and Arduino core for ESP8266 are still unpatched.</p><h1 id=patches>Patches</h1><p>Espressif has fixed such problem and committed patches for ESP32 SDK, however, as of the date of this post, the NONOS SDK and Arduino core for ESP8266 appears to be unpatched. The security patches can be tracked in the following commit link:</p><ul><li><a href=https://github.com/espressif/esp-idf/releases/tag/v3.3 target=_blank rel=noopener>ESP32 ESP-IDF Stable Release 3.3 (5 September, 2019)</a></li><li><a href=https://github.com/espressif/esp-idf/commit/8009320fb44abaf8acf8a1e1a38a67fc4c8d458c target=_blank rel=noopener>ESP32 ESP-IDF Development Master (30 May, 2019)</a></li><li><a href=https://github.com/espressif/arduino-esp32/releases/tag/1.0.3-rc3 target=_blank rel=noopener>Arduino-ESP32 Stable Release 1.0.3 RC3 (5 September, 2019)</a></li><li><a href=https://github.com/espressif/esp-idf/commit/8009320fb44abaf8acf8a1e1a38a67fc4c8d458c target=_blank rel=noopener>Arduino-ESP32 Development Master (August 20, 2019)</a></li></ul><h1 id=proof-of-concept-tool>Proof of Concept tool</h1><p>If you wish to test your ESP32/8266 device against this vulnerability, you can check my repository:</p><p><a href=https://github.com/Matheus-Garbelini/esp32_esp8266_attacks>https://github.com/Matheus-Garbelini/esp32_esp8266_attacks</a></p></div><div class=article-tags><a class="badge badge-light" href=../../tag/esp32/>ESP32</a>
<a class="badge badge-light" href=../../tag/esp8266/>ESP8266</a>
<a class="badge badge-light" href=../../tag/arduino/>Arduino</a></div><div class=share-box aria-hidden=true><ul class=share><li><a href="https://twitter.com/intent/tweet?url=../../post/esp32-esp8266-eap-crash/&text=ESP32/ESP8266%20EAP%20client%20crash%20%28CVE-2019-12586%29" target=_blank rel=noopener class=share-btn-twitter><i class="fab fa-twitter"></i></a></li><li><a href="https://www.facebook.com/sharer.php?u=/post/esp32-esp8266-eap-crash/&t=ESP32/ESP8266%20EAP%20client%20crash%20%28CVE-2019-12586%29" target=_blank rel=noopener class=share-btn-facebook><i class="fab fa-facebook"></i></a></li><li><a href="mailto:?subject=ESP32/ESP8266%20EAP%20client%20crash%20%28CVE-2019-12586%29&body=/post/esp32-esp8266-eap-crash/" target=_blank rel=noopener class=share-btn-email><i class="fas fa-envelope"></i></a></li><li><a href="https://www.linkedin.com/shareArticle?url=../../post/esp32-esp8266-eap-crash/&title=ESP32/ESP8266%20EAP%20client%20crash%20%28CVE-2019-12586%29" target=_blank rel=noopener class=share-btn-linkedin><i class="fab fa-linkedin-in"></i></a></li><li><a href="whatsapp://send?text=ESP32/ESP8266%20EAP%20client%20crash%20%28CVE-2019-12586%29%20/post/esp32-esp8266-eap-crash/" target=_blank rel=noopener class=share-btn-whatsapp><i class="fab fa-whatsapp"></i></a></li><li><a href="https://service.weibo.com/share/share.php?url=../../post/esp32-esp8266-eap-crash/&title=ESP32/ESP8266%20EAP%20client%20crash%20%28CVE-2019-12586%29" target=_blank rel=noopener class=share-btn-weibo><i class="fab fa-weibo"></i></a></li></ul></div><div class="media author-card content-widget-hr"><img class="avatar mr-3 avatar-circle" src=../../authors/admin/avatar_hu38aa9ece1342b1a2f7956d9bc06f2af8_55786_270x270_fill_q75_lanczos_center.jpg alt="Matheus Eduardo Garbelini"><div class=media-body><h5 class=card-title>Matheus Eduardo Garbelini</h5><h6 class=card-subtitle>Ph.D Student</h6><p class=card-text>My research interests include distributed Wireless Security, IoTs, Embedded Systems and Software/Hardware engineering.</p><ul class=network-icon aria-hidden=true><li><a href=mailto:matheus_garbelini@mymail.sutd.edu.sg><i class="fas fa-envelope"></i></a></li><li><a href=https://twitter.com/MatheusGarbelin target=_blank rel=noopener><i class="fab fa-twitter"></i></a></li><li><a href="https://scholar.google.com/citations?user=_PXBxu0AAAAJ&hl=en#" target=_blank rel=noopener><i class="fas fa-graduation-cap"></i></a></li><li><a href=https://github.com/Matheus-Garbelini/ target=_blank rel=noopener><i class="fab fa-github"></i></a></li></ul></div></div><section id=comments><div id=commento></div><script src=https://mote.ddns.net:3031/js/commento.js defer></script></section><div class="article-widget content-widget-hr"><h3>Related</h3><ul><li><a href=../../post/zero-pmk-installation/>Zero PMK Installation (CVE-2019-12587)</a></li><li><a href=../../post/esp8266-beacon-frame-crash/>ESP8266 Beacon Frame Crash (CVE-2019-12588)</a></li></ul></div></div></article></div><div class=page-footer><div class=container><footer class=site-footer><p class=powered-by></p><p class=powered-by>Published with
<a href="https://wowchemy.com/?utm_campaign=poweredby" target=_blank rel=noopener>Wowchemy</a> —
the free, <a href=https://github.com/wowchemy/wowchemy-hugo-modules target=_blank rel=noopener>open source</a> website builder that empowers creators.</p></footer></div></div><div id=modal class="modal fade" role=dialog><div class=modal-dialog><div class=modal-content><div class=modal-header><h5 class=modal-title>Cite</h5><button type=button class=close data-dismiss=modal aria-label=Close>
<span aria-hidden=true>&#215;</span></button></div><div class=modal-body><pre><code class="tex hljs"></code></pre></div><div class=modal-footer><a class="btn btn-outline-primary my-1 js-copy-cite" href=# target=_blank><i class="fas fa-copy"></i>Copy</a>
<a class="btn btn-outline-primary my-1 js-download-cite" href=# target=_blank><i class="fas fa-download"></i>Download</a><div id=modal-error></div></div></div></div></div><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/instant.page/5.1.0/instantpage.min.js integrity="sha512-1+qUtKoh9XZW7j+6LhRMAyOrgSQKenQ4mluTR+cvxXjP1Z54RxZuzstR/H9kgPXQsVB8IW7DMDFUJpzLjvhGSQ==" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.8.4/mermaid.min.js integrity="sha512-as1BF4+iHZ3BVO6LLDQ7zrbvTXM+c/1iZ1qII/c3c4L8Rn5tHLpFUtpaEtBNS92f+xGsCzsD7b62XP3XYap6oA==" crossorigin=anonymous title=mermaid></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/highlight.min.js integrity="sha512-TDKKr+IvoqZnPzc3l35hdjpHD0m+b2EC2SrLEgKDRWpxf2rFCxemkgvJ5kfU48ip+Y+m2XVKyOCD85ybtlZDmw==" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/r.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.js integrity="sha512-SeiQaaDh73yrb56sTW/RgVdi/mMqNeM2oBwubFHagc5BkixSpP1fvqF47mKzPGWYSSy4RwbBunrJBQ4Co8fRWA==" crossorigin=anonymous></script><script id=search-hit-fuse-template type=text/x-template>
        <div class="search-hit" id="summary-{{key}}">
          <div class="search-hit-content">
            <div class="search-hit-name">
              <a href="{{relpermalink}}">{{title}}</a>
              <div class="article-metadata search-hit-type">{{type}}</div>
              <p class="search-hit-description">{{snippet}}</p>
            </div>
          </div>
        </div>
      </script><script src=https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin=anonymous></script><script src=../../js/_vendor/bootstrap.bundle.min.f81d0a1705048649befc8b595e455a94.js></script><script src=../../en/js/wowchemy.min.e20609e6ad3f7fce339ee2e74f13682b.js></script></body></html>