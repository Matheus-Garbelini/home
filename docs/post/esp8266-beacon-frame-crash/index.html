<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 5.0.0-beta.3 for Hugo"><meta name=author content="Matheus Eduardo Garbelini"><meta name=description content="Easily crashing ESP8266 Wi-Fi devices"><link rel=alternate hreflang=en-us href=../../post/esp8266-beacon-frame-crash/><link rel=preconnect href=https://fonts.gstatic.com crossorigin><meta name=theme-color content="#1565c0"><script src=../../js/mathjax-config.js></script><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.0/css/academicons.min.css integrity="sha512-W4yqoT1+8NLkinBLBZko+dFB2ZbHsYLDdr50VElllRcNt2Q4/GSs6u71UHKxB7S6JEMCp5Ve4xjh3eGQl/HRvg==" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css integrity="sha256-FMvZuGapsJLjouA6k7Eo2lusoAX9i0ShlWFG6qt7SLc=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/github.min.css crossorigin=anonymous title=hl-light media=print onload="this.media='all'"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/dracula.min.css crossorigin=anonymous title=hl-dark media=print onload="this.media='all'" disabled><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.css integrity="sha512-1xoFisiGdy9nvho8EgXuXvnpR5GAMSjFwp40gSRE3NwdUdIMIKuPa7bqoUhLD0O/5tPNhteAsE5XyyMi5reQVA==" crossorigin=anonymous media=print onload="this.media='all'"><script src=https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.2.2/lazysizes.min.js integrity="sha512-TmDwFLhg3UA4ZG0Eb4MIyT1O1Mb+Oww5kFG0uHqXsdbyZz9DcvYQhKpGgNkamAI6h2lGGZq2X8ftOJvF/XjTUg==" crossorigin=anonymous async></script><script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js integrity crossorigin=anonymous async></script><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload="this.media='all'"><link rel=stylesheet href=../../css/wowchemy.dcfbcbc9c1fc922bede8b95538a0ef51.css><link rel=manifest href=../../index.webmanifest><link rel=icon type=image/png href=../../images/icon_hue96a2db987773b26a138959a554df568_81308_32x32_fill_lanczos_center_2.png><link rel=apple-touch-icon type=image/png href=../../images/icon_hue96a2db987773b26a138959a554df568_81308_180x180_fill_lanczos_center_2.png><link rel=canonical href=../../post/esp8266-beacon-frame-crash/><meta property="twitter:card" content="summary_large_image"><meta property="og:site_name" content="M. E. Garbelini"><meta property="og:url" content="/post/esp8266-beacon-frame-crash/"><meta property="og:title" content="ESP8266 Beacon Frame Crash (CVE-2019-12588) | M. E. Garbelini"><meta property="og:description" content="Easily crashing ESP8266 Wi-Fi devices"><meta property="og:image" content="/post/esp8266-beacon-frame-crash/featured.png"><meta property="twitter:image" content="/post/esp8266-beacon-frame-crash/featured.png"><meta property="og:locale" content="en-us"><meta property="article:published_time" content="2019-09-03T11:31:29+08:00"><meta property="article:modified_time" content="2017-11-21T21:47:02+00:00"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"/post/esp8266-beacon-frame-crash/"},"headline":"ESP8266 Beacon Frame Crash (CVE-2019-12588)","image":["/post/esp8266-beacon-frame-crash/featured.png"],"datePublished":"2019-09-03T11:31:29+08:00","dateModified":"2017-11-21T21:47:02Z","author":{"@type":"Person","name":"Matheus Eduardo Garbelini"},"publisher":{"@type":"Organization","name":"M. E. Garbelini","logo":{"@type":"ImageObject","url":"/images/icon_hue96a2db987773b26a138959a554df568_81308_192x192_fill_lanczos_center_2.png"}},"description":"Easily crashing ESP8266 Wi-Fi devices"}</script><title>ESP8266 Beacon Frame Crash (CVE-2019-12588) | M. E. Garbelini</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper><script src=../../js/wowchemy-init.min.9f8405b7756f5e178a738a09c302f8b3.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class=col-6><h1>Search</h1></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=Close><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box><input name=q id=search-query placeholder=Search... autocapitalize=off autocomplete=off autocorrect=off spellcheck=false type=search class=form-control aria-label=Search...></div></section><section class=section-search-results><div id=search-hits></div></section></div></aside><div class=page-header><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=../../>M. E. Garbelini</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar aria-expanded=false aria-label="Toggle navigation">
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=../../>M. E. Garbelini</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=../../#about><span>Home</span></a></li><li class=nav-item><a class=nav-link href=../../#posts><span>Posts</span></a></li><li class=nav-item><a class=nav-link href=../../#featured><span>Publications</span></a></li><li class=nav-item><a class=nav-link href=../../#contact><span>Contact</span></a></li><li class=nav-item><a class=nav-link href=../../media/cv_matheus_garbelini.pdf><span>CV</span></a></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=Search><i class="fas fa-search" aria-hidden=true></i></a></li></ul></div></nav></div><div class=page-body><article class=article><div class="article-container pt-3"><h1>ESP8266 Beacon Frame Crash (CVE-2019-12588)</h1><p class=page-subtitle>Easily crashing ESP8266 Wi-Fi devices</p><div class=article-metadata><div><span>Matheus Eduardo Garbelini</span></div><span class=article-date>Last updated on
Nov 21, 2017</span>
<span class=middot-divider></span><span class=article-reading-time>3 min read</span>
<span class=middot-divider></span><span class=article-categories><i class="fas fa-folder mr-1"></i><a href=../../category/vulnerability-disclosure/>Vulnerability Disclosure</a></span></div></div><div class="article-header article-container featured-image-wrapper mt-4 mb-4" style=max-width:720px;max-height:324px><div style=position:relative><img src=../../post/esp8266-beacon-frame-crash/featured_hu92a9b4462b89f2a7dd1e1e423a99d951_569705_720x0_resize_lanczos_2.png alt class=featured-image></div></div><div class=article-container><div class=article-style><h1 id=vulnerability-description>Vulnerability Description</h1><p><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-12588" target=_blank rel=noopener>CVE-2019-12588</a>: The client 802.11 MAC implementation in Espressif ESP8266 <strong>NONOS SDK 3.0 and earlier</strong> does not validate correctly the RSN AuthKey suite list count in beacon frames, probe responses, and association responses, which allows attackers in radio range to cause a denial of service (crash) via a crafted message.</p><p>The affected stable and development versions are listed below:</p><ul><li>NONOS SDK Stable <a href=https://github.com/espressif/ESP8266_NONOS_SDK/releases/tag/v3.0 target=_blank rel=noopener>release 3.0</a> and earlier. Vulnerable until <strong>July 15, 2019</strong>.</li><li>NONOS SDK Development master <a href=https://github.com/espressif/ESP8266_NONOS_SDK/commit/b2db392901bb54730b35947825a5f3f15e80eeb5 target=_blank rel=noopener>#b2db392</a> and earlier. Vulnerable until <strong>July 3, 2019</strong>.</li><li>NONOS SDK Backport 2.2.X <a href=https://github.com/espressif/ESP8266_NONOS_SDK/commit/9fe634e701f4f116912401c33ed8d297923bdbef target=_blank rel=noopener>#9fe634e</a> and earlier. Vulnerable until <strong>July 3, 2019</strong>.</li><li>NONOS SDK Backport 3.0.0 <a href=https://github.com/espressif/ESP8266_NONOS_SDK/commit/fc041703e0d900b8f4814f4f499e62599c626fae target=_blank rel=noopener>#fc04170</a> and earlier. Vulnerable until <strong>July 3, 2019</strong>.</li><li>Arduino ESP8266 Release 2.5.2 and earlier. <strong>Still vulnerable as of September 5, 2019</strong>.</li><li>Arduino ESP8266 Development master <a href=https://github.com/esp8266/Arduino/commit/a0634a71a9240ea2ecb326d01159a31ae511a531 target=_blank rel=noopener>#a0634a7</a>. Vulnerable until <strong>July 5, 2019</strong>.</li></ul><p>Two situations in a malformed beacon frame can trigger this problem:</p><ul><li>When sending crafted 802.11 frames with the field Auth Key Management Suite Count (AKM) in RSN tag with size too large or incorrect, ESP8266 in station mode crashes.</li><li>When sending crafted 802.11 frames with the field Pairwise Cipher Suite Count in RSN tag with size too large or incorrect, ESP8266 in station mode crashes.</li></ul><h1 id=exploitation-scenario>Exploitation Scenario</h1><p>The vulnerability can be better understood when presented in the following diagram:</p><img src=esp8266_beacon_crash_scenario.png alt=drawing width=550><p>In the scenario above, the attacker sends a malformed beacon or probe response to a ESP8266 which is already connected to an access point. However, it was found that ESP8266 can crash even when there&rsquo;s no connection to a AP, that is even when ESP8266 is just scanning for the AP.</p><p>When capturing some packets in Wireshark, it&rsquo;s easy to see which fields are affected. As shown in the figure below, the affected field is the <strong>Auth Key Mangement (AKM) Suite Count</strong>.</p><img src=invalid_beacon_frame1.png alt=drawing width=750><p>In this case, NONOS SDK is not verifying correctly AKM Suite count field against unexpected valued. This AKM field is used to tell how many authentication methods (suites) are allowed to be used during the key exchange with the AP.</p><p>As for the <strong>Pairwise Cipher Suite Count</strong> field, which tells the client how many methods can be used for encryption, a crash also occurs when the count number is higher then expected. This is exemplified in the figure below.</p><img src=invalid_beacon_frame2.png alt=drawing width=750><p>In both cases, ESP8266 NONOS SDK is not expecting to receive an exceeding value (6 and 10 in this case). This indicates that this attack may be triggering a buffer overflow. You can download the capture example of such crafted packet <a href=esp8266-beacon-frame-crash.zip>here</a>.</p><h1 id=impact>Impact</h1><p>As mentioned before, an attacker can crash any ESP8266 Wi-Fi client within radio range by just creating a fake beacon frame or probe response. This is specially dangerous for projects that are using ESP8266 for automation (e.g. <a href=https://www.openplcproject.com/ target=_blank rel=noopener>openplc project</a>) which relies in operating actuators such as relays and motors while continuously communication with a programmable logic controller (PLC). In addition, products and projects that uses ESP8266 for smart home or as AT device are mostly vulnerable if their firmware was not recently updated.</p><h1 id=patches>Patches</h1><p>Espressif has fixed such problem and committed patches in their <a href=https://github.com/espressif/ESP8266_NONOS_SDK target=_blank rel=noopener>NONOS SDK</a> repository since July 3, 2019. The specific security patches can be tracked in the following commit/release links:</p><ul><li><a href=https://github.com/espressif/ESP8266_NONOS_SDK/releases/tag/v3.0.1 target=_blank rel=noopener>NONOS SDK Stable release 3.0.1 (July 15, 2019)</a></li></ul><ul><li><a href=https://github.com/espressif/ESP8266_NONOS_SDK/commit/9a17038b0fb3318a761c40ae6146c54d6a414ab4 target=_blank rel=noopener>NONOS SDK Development master (July 3, 2019)</a></li><li><a href=https://github.com/espressif/ESP8266_NONOS_SDK/commit/876abc5705d08f79f176988ddb5a6d077214c19c target=_blank rel=noopener>NONOS SDK Backport 2.2.X (July 3, 2019)</a></li><li><a href=https://github.com/espressif/ESP8266_NONOS_SDK/commit/9d591d14491a07a506b868d60f4ec12894702dc3 target=_blank rel=noopener>NONOS SDK Backport 3.0.0 (July 3, 2019)</a></li><li><a href=https://github.com/esp8266/Arduino/commit/403001e37c65994d241f284beba1d0171f5fb50e target=_blank rel=noopener>Arduino ESP866 Development Master (July 5, 2019)</a></li></ul><p>Make sure to update your SDK today, don&rsquo;t delay.</p><h1 id=proof-of-concept-tool>Proof of Concept tool</h1><p>If you wish to test your ESP8266 device against this vulnerability, you can check my repository:</p><p><a href=https://github.com/Matheus-Garbelini/esp32_esp8266_attacks>https://github.com/Matheus-Garbelini/esp32_esp8266_attacks</a></p></div><div class=article-tags><a class="badge badge-light" href=../../tag/esp8266/>ESP8266</a>
<a class="badge badge-light" href=../../tag/arduino/>Arduino</a></div><div class=share-box aria-hidden=true><ul class=share><li><a href="https://twitter.com/intent/tweet?url=../../post/esp8266-beacon-frame-crash/&text=ESP8266%20Beacon%20Frame%20Crash%20%28CVE-2019-12588%29" target=_blank rel=noopener class=share-btn-twitter><i class="fab fa-twitter"></i></a></li><li><a href="https://www.facebook.com/sharer.php?u=/post/esp8266-beacon-frame-crash/&t=ESP8266%20Beacon%20Frame%20Crash%20%28CVE-2019-12588%29" target=_blank rel=noopener class=share-btn-facebook><i class="fab fa-facebook"></i></a></li><li><a href="mailto:?subject=ESP8266%20Beacon%20Frame%20Crash%20%28CVE-2019-12588%29&body=/post/esp8266-beacon-frame-crash/" target=_blank rel=noopener class=share-btn-email><i class="fas fa-envelope"></i></a></li><li><a href="https://www.linkedin.com/shareArticle?url=../../post/esp8266-beacon-frame-crash/&title=ESP8266%20Beacon%20Frame%20Crash%20%28CVE-2019-12588%29" target=_blank rel=noopener class=share-btn-linkedin><i class="fab fa-linkedin-in"></i></a></li><li><a href="whatsapp://send?text=ESP8266%20Beacon%20Frame%20Crash%20%28CVE-2019-12588%29%20/post/esp8266-beacon-frame-crash/" target=_blank rel=noopener class=share-btn-whatsapp><i class="fab fa-whatsapp"></i></a></li><li><a href="https://service.weibo.com/share/share.php?url=../../post/esp8266-beacon-frame-crash/&title=ESP8266%20Beacon%20Frame%20Crash%20%28CVE-2019-12588%29" target=_blank rel=noopener class=share-btn-weibo><i class="fab fa-weibo"></i></a></li></ul></div><div class="media author-card content-widget-hr"><img class="avatar mr-3 avatar-circle" src=../../authors/admin/avatar_hu38aa9ece1342b1a2f7956d9bc06f2af8_55786_270x270_fill_q75_lanczos_center.jpg alt="Matheus Eduardo Garbelini"><div class=media-body><h5 class=card-title>Matheus Eduardo Garbelini</h5><h6 class=card-subtitle>Ph.D Student</h6><p class=card-text>My research interests include distributed Wireless Security, IoTs, Embedded Systems and Software/Hardware engineering.</p><ul class=network-icon aria-hidden=true><li><a href=mailto:matheus_garbelini@mymail.sutd.edu.sg><i class="fas fa-envelope"></i></a></li><li><a href=https://twitter.com/MatheusGarbelin target=_blank rel=noopener><i class="fab fa-twitter"></i></a></li><li><a href="https://scholar.google.com/citations?user=_PXBxu0AAAAJ&hl=en#" target=_blank rel=noopener><i class="fas fa-graduation-cap"></i></a></li><li><a href=https://github.com/Matheus-Garbelini/ target=_blank rel=noopener><i class="fab fa-github"></i></a></li></ul></div></div><section id=comments><div id=commento></div><script src=https://mote.ddns.net:3031/js/commento.js defer></script></section><div class="article-widget content-widget-hr"><h3>Related</h3><ul><li><a href=../../post/esp32-esp8266-eap-crash/>ESP32/ESP8266 EAP client crash (CVE-2019-12586)</a></li><li><a href=../../post/zero-pmk-installation/>Zero PMK Installation (CVE-2019-12587)</a></li></ul></div></div></article></div><div class=page-footer><div class=container><footer class=site-footer><p class=powered-by></p><p class=powered-by>Published with
<a href="https://wowchemy.com/?utm_campaign=poweredby" target=_blank rel=noopener>Wowchemy</a> —
the free, <a href=https://github.com/wowchemy/wowchemy-hugo-modules target=_blank rel=noopener>open source</a> website builder that empowers creators.</p></footer></div></div><div id=modal class="modal fade" role=dialog><div class=modal-dialog><div class=modal-content><div class=modal-header><h5 class=modal-title>Cite</h5><button type=button class=close data-dismiss=modal aria-label=Close>
<span aria-hidden=true>&#215;</span></button></div><div class=modal-body><pre><code class="tex hljs"></code></pre></div><div class=modal-footer><a class="btn btn-outline-primary my-1 js-copy-cite" href=# target=_blank><i class="fas fa-copy"></i>Copy</a>
<a class="btn btn-outline-primary my-1 js-download-cite" href=# target=_blank><i class="fas fa-download"></i>Download</a><div id=modal-error></div></div></div></div></div><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/instant.page/5.1.0/instantpage.min.js integrity="sha512-1+qUtKoh9XZW7j+6LhRMAyOrgSQKenQ4mluTR+cvxXjP1Z54RxZuzstR/H9kgPXQsVB8IW7DMDFUJpzLjvhGSQ==" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.8.4/mermaid.min.js integrity="sha512-as1BF4+iHZ3BVO6LLDQ7zrbvTXM+c/1iZ1qII/c3c4L8Rn5tHLpFUtpaEtBNS92f+xGsCzsD7b62XP3XYap6oA==" crossorigin=anonymous title=mermaid></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/highlight.min.js integrity="sha512-TDKKr+IvoqZnPzc3l35hdjpHD0m+b2EC2SrLEgKDRWpxf2rFCxemkgvJ5kfU48ip+Y+m2XVKyOCD85ybtlZDmw==" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/r.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.js integrity="sha512-SeiQaaDh73yrb56sTW/RgVdi/mMqNeM2oBwubFHagc5BkixSpP1fvqF47mKzPGWYSSy4RwbBunrJBQ4Co8fRWA==" crossorigin=anonymous></script><script id=search-hit-fuse-template type=text/x-template>
        <div class="search-hit" id="summary-{{key}}">
          <div class="search-hit-content">
            <div class="search-hit-name">
              <a href="{{relpermalink}}">{{title}}</a>
              <div class="article-metadata search-hit-type">{{type}}</div>
              <p class="search-hit-description">{{snippet}}</p>
            </div>
          </div>
        </div>
      </script><script src=https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin=anonymous></script><script src=../../js/_vendor/bootstrap.bundle.min.f81d0a1705048649befc8b595e455a94.js></script><script src=../../en/js/wowchemy.min.e20609e6ad3f7fce339ee2e74f13682b.js></script></body></html>